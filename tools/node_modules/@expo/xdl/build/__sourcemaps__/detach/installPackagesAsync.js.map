{"version":3,"sources":["detach/installPackagesAsync.ts"],"names":["installPackagesAsync","projectDir","packages","options","packageManager","packageLockJsonExists","fs","pathExists","path","join","yarnExists","yarnExistsAsync","logger","info","length","cwd","stdio","version","stdout","trim","semver","valid","e"],"mappings":";;;;;;;AAAA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AACA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;AAEA;AAAA;;AAAA;AAAA;AAAA;;AAAA;AAAA;;;;AAEe,eAAeA,oBAAf,CACbC,UADa,EAEbC,QAAkB,GAAG,EAFR,EAGbC,OAAY,GAAG,EAHF,EAIE;AACf,MAAIC,cAAc,GAAG,KAArB;;AACA,MAAID,OAAO,CAACC,cAAZ,EAA4B;AAC1BA,IAAAA,cAAc,GAAGD,OAAO,CAACC,cAAzB;AACD,GAFD,MAEO;AACL,UAAMC,qBAA8B,GAAG,MAAMC,mBAAGC,UAAH,CAC3CC,gBAAKC,IAAL,CAAUR,UAAV,EAAsB,mBAAtB,CAD2C,CAA7C;AAGA,UAAMS,UAAU,GAAG,MAAMC,eAAe,EAAxC;AACAP,IAAAA,cAAc,GAAGM,UAAU,IAAI,CAACL,qBAAf,GAAuC,MAAvC,GAAgD,KAAjE;AACD;;AAED,MAAID,cAAc,KAAK,MAAvB,EAA+B;AAC7BQ,sBAAOC,IAAP,CAAa,uCAAb;;AACA,QAAIX,QAAQ,CAACY,MAAT,KAAoB,CAAxB,EAA2B;AACzB,YAAM,2BAAW,SAAX,EAAsB,CAAC,UAAD,CAAtB,EAAoC;AACxCC,QAAAA,GAAG,EAAEd,UADmC;AAExCe,QAAAA,KAAK,EAAE;AAFiC,OAApC,CAAN;AAID,KALD,MAKO;AACL,YAAM,2BAAW,SAAX,EAAsB,CAAC,KAAD,EAAQ,UAAR,EAAoB,GAAGd,QAAvB,CAAtB,EAAwD;AAC5Da,QAAAA,GAAG,EAAEd,UADuD;AAE5De,QAAAA,KAAK,EAAE;AAFqD,OAAxD,CAAN;AAID;AACF,GAbD,MAaO;AACLJ,sBAAOC,IAAP,CAAa,sCAAb;;AACA,QAAI,EAAE,MAAMP,mBAAGC,UAAH,CAAcC,gBAAKC,IAAL,CAAUR,UAAV,EAAsB,cAAtB,CAAd,CAAR,CAAJ,EAAmE;AACjE,YAAM,2BAAW,KAAX,EAAkB,CAAC,SAAD,EAAY,YAAZ,EAA0B,OAA1B,CAAlB,EAAsD;AAC1Dc,QAAAA,GAAG,EAAEd,UADqD;AAE1De,QAAAA,KAAK,EAAE;AAFmD,OAAtD,CAAN;AAID;;AACD,UAAM,2BAAW,KAAX,EAAkB,CAAC,SAAD,EAAY,QAAZ,EAAsB,YAAtB,EAAoC,OAApC,EAA6C,GAAGd,QAAhD,CAAlB,EAA6E;AACjFa,MAAAA,GAAG,EAAEd,UAD4E;AAEjFe,MAAAA,KAAK,EAAE;AAF0E,KAA7E,CAAN;AAID;AACF;;AAED,eAAeL,eAAf,GAAiC;AAC/B,MAAI;AACF,UAAMM,OAAO,GAAG,CAAC,MAAM,2BAAW,SAAX,EAAsB,CAAC,WAAD,CAAtB,CAAP,EAA6CC,MAA7C,CAAoDC,IAApD,EAAhB;AACA,WAAO,CAAC,CAACC,kBAAOC,KAAP,CAAaJ,OAAb,CAAT;AACD,GAHD,CAGE,OAAOK,CAAP,EAAU;AACV,WAAO,KAAP;AACD;AACF","sourcesContent":["import spawnAsync from '@expo/spawn-async';\nimport fs from 'fs-extra';\nimport path from 'path';\nimport semver from 'semver';\n\nimport logger from './Logger';\n\nexport default async function installPackagesAsync(\n  projectDir: string,\n  packages: string[] = [],\n  options: any = {}\n): Promise<void> {\n  let packageManager = 'npm';\n  if (options.packageManager) {\n    packageManager = options.packageManager;\n  } else {\n    const packageLockJsonExists: boolean = await fs.pathExists(\n      path.join(projectDir, 'package-lock.json')\n    );\n    const yarnExists = await yarnExistsAsync();\n    packageManager = yarnExists && !packageLockJsonExists ? 'yarn' : 'npm';\n  }\n\n  if (packageManager === 'yarn') {\n    logger.info(`Installing dependencies using Yarn...`);\n    if (packages.length === 0) {\n      await spawnAsync('yarnpkg', ['--silent'], {\n        cwd: projectDir,\n        stdio: 'inherit',\n      });\n    } else {\n      await spawnAsync('yarnpkg', ['add', '--silent', ...packages], {\n        cwd: projectDir,\n        stdio: 'inherit',\n      });\n    }\n  } else {\n    logger.info(`Installing dependencies using npm...`);\n    if (!(await fs.pathExists(path.join(projectDir, 'node_modules')))) {\n      await spawnAsync('npm', ['install', '--loglevel', 'error'], {\n        cwd: projectDir,\n        stdio: 'inherit',\n      });\n    }\n    await spawnAsync('npm', ['install', '--save', '--loglevel', 'error', ...packages], {\n      cwd: projectDir,\n      stdio: 'inherit',\n    });\n  }\n}\n\nasync function yarnExistsAsync() {\n  try {\n    const version = (await spawnAsync('yarnpkg', ['--version'])).stdout.trim();\n    return !!semver.valid(version);\n  } catch (e) {\n    return false;\n  }\n}\n"],"file":"../../detach/installPackagesAsync.js","sourceRoot":"/@expo/xdl@59.2.1/src"}